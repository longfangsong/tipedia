<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta name="public-url" content="https://longfangsong.github.io/tipedia">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="The free encyclopedia for TiDB and related works">
    <link rel="icon" href="https://longfangsong.github.io/tipedia/static/favicon.ico">
    <link rel="apple-touch-icon" href="https://longfangsong.github.io/tipedia/static/logo192.png">
    <link rel="manifest" href="https://longfangsong.github.io/tipedia/static/manifest.json">
    <link rel="stylesheet" href="https://longfangsong.github.io/tipedia/static/mui.css">
    
<link rel="stylesheet" href="https://longfangsong.github.io/tipedia/static/page.css">

    <meta name="google-site-verification" content="eIlbRaKM-jgH9zQg2VFwWY4H-027wQlW6K-TWdEvI1g">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5LTBF6TXNL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-5LTBF6TXNL');
    </script>
    <title>Tipedia • Offline</title>
    <script>
        const site_index = [{"articles":[{"aliases":[],"category":"concept","filename":"RaftEngine-6b5e10990b8b2c66698577fffb42a4da","name":"RaftEngine","section":"what","summary":"一个代表了 “基于 Raft 的一致性存储引擎” 的抽象，生产过程中主要使用的实现为 RaftLogEngine。","tags":["TiKV","raft"]},{"aliases":[],"category":"component","filename":"RaftEngine","name":"RaftEngine","section":"what","summary":"一个用于储存 multi-raft log 的 WAL-is-data 引擎。用于替代原先用于存储 multi-raft log 的单独 RocksDB。","tags":["TiKV","Raft"]}],"name":"RaftEngine"},{"articles":[{"aliases":[],"category":"concept","filename":"Filter","name":"Filter","section":"what","summary":"Filter 指一种用于筛选调度过程中 能作为源/目标 store 的 store 的对象。","tags":["PD","scheduling"]},{"aliases":["table-filter"],"category":"component","filename":"Filter-096ad653af708bc1f0a69dfe8783d390","name":"Filter","section":"what","summary":"在 TiDB 的各个周边工具中，可以使用 Filter 语法，过滤出一部分 TiDB 中的表进行操作。","tags":["tools","br","dumpling","lightning"]}],"name":"Filter"},{"articles":[{"aliases":[],"category":"concept","filename":"Column","name":"Column","section":"what","summary":"传统关系型数据库中的一列（这个在港台地区叫行）。","tags":[]},{"aliases":[],"category":"concept","filename":"Column-b1fb2562d61cb19ceadd92fd836d470b","name":"Column","section":"what","summary":"在 NoSQL 或者 NewSQL 数据库中，Column 指 一个 (key, value, timestamp) 元组。","tags":[]}],"name":"Column"},{"articles":[{"aliases":[],"category":"concept","filename":"Probe 表","name":"Build 表","section":"what","summary":"对于两张待 join 的表 t1, t2。选取其中的一张表按照 join 条件给的列建立hash 表。然后扫描另外一张表，一行一行去建好的 hash 表判断是否有对应相等的行来完成 join 操作，这个操作我们称之为 probe (探测)。前一张表我们叫做 build 表，后一张表我们的叫做 Probe 表。","tags":["TiDB","optimizer"]},{"aliases":[],"category":"concept","filename":"Build 表","name":"Build 表","section":"what","summary":"对于两张待 join 的表 t1, t2。选取其中的一张表按照 join 条件给的列建立hash 表。然后扫描另外一张表，一行一行去建好的 hash 表判断是否有对应相等的行来完成 join 操作，这个操作我们称之为 probe (探测)。前一张表我们叫做 build 表，后一张表我们的叫做 probe 表。","tags":["TiDB","optimizer"]}],"name":"Build 表"},{"articles":[{"aliases":[],"category":"concept","filename":"Operator","name":"Operator","section":"what","summary":"Operator 是应用于一个 Region 的，服务于某个调度目的的一系列操作的集合。例如“将 Region 2 的 Leader 迁移至 Store 5”，“将 Region 2 的副本迁移到 Store 1, 4, 5” 等。","tags":["PD","scheduling"]},{"aliases":[],"category":"component","filename":"Operator-f5f4846e806f6bc8475f39c419dcc931","name":"Operator","section":"what","summary":"指 tidb 的 k8s operator。","tags":[]}],"name":"Operator"},{"articles":[{"aliases":[],"category":"concept","filename":"RocksEngine","name":"RocksEngine","section":"what","summary":"基于 RocksDB 的存储引擎。","tags":["TiKV","raft"]},{"aliases":[],"category":"concept","filename":"RocksEngine-5f00d514e62a0e1450d081d96d9fa635","name":"RocksEngine","section":"what","summary":"一个基于 RocksDB 的 Engine。","tags":["TiKV","RocksDB"]}],"name":"RocksEngine"},{"aliases":[],"category":"concept","filename":"RaftMessage","name":"RaftMessage","section":"what","summary":"其他 Peer 发送过来关于 Raft 状态机本身的消息，包括心跳、日志、投票消息等。","tags":["TiKV","raft"]},{"aliases":["SLI","Service level indicator"],"category":"concept","filename":"服务级别指标","name":"服务级别指标","section":"what","summary":"服务级别指标（ SLI ）是对服务提供商提供给客户的服务级别的度量。","tags":["DBaaS"]},{"aliases":[],"category":"feature","filename":"Pipelined Pessimistic Lock","name":"Pipelined Pessimistic Lock","section":"what","summary":"即 TiDB 发出加悲观锁请求后立即执行后面的语句，后台异步写入悲观锁。","tags":["txn","TiDB","TiKV"]},{"aliases":[],"category":"concept","filename":"TableID","name":"TableID","section":"what","summary":"为了保证同一个表的数据放在一起，方便查找，TiDB 会为每个表分配一个表 ID，用 TableID 表示。表 ID 是一个整数，在整个集群内唯一。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"bypass_locks","name":"bypass_locks","section":"what","summary":"在 client 从 TiKV 中读取过程中，别的事务的 min_commit_ts 会被向前推进，然后这向前推的这段时间内被锁住的 key 就不会再 block 这个事务的读。","tags":["TiKV","mvcc"]},{"aliases":["distinct-filter"],"category":"concept","filename":"distinctScoreFilter","name":"distinctScoreFilter","section":"what","summary":"distinctScoreFilter保证distinct score不会下降。","tags":["pd","scheduling"]},{"aliases":["service-level agreement","SLA"],"category":"concept","filename":"服务级别协议","name":"服务级别协议","section":"what","summary":"服务提供商与客户之间定义的正式承诺。","tags":[]},{"aliases":[],"category":"concept","filename":"CompactionFilter","name":"CompactionFilter","section":"what","summary":"CompactionFilter 可以在 rocksdb 进行 compaction 时，根据自定义逻辑去删除/修改 key/value 对。","tags":["rocksdb"]},{"aliases":["ANALYZE","搜集统计信息"],"category":"feature","filename":"ANALYZE TABLE","name":"ANALYZE TABLE","section":"what","summary":"TiDB 通过这一语句搜集统计数据，作为优化器的输入。","tags":["TiDB","planner","stastic"]},{"aliases":[],"category":"feature","filename":"Green GC","name":"Green GC","section":"what","summary":"使得GC过程中可以跳过 raft 层直接resolve lock。","tags":[]},{"aliases":[],"category":"concept","filename":"Load base split","name":"Load base split","section":"what","summary":"Load Base Split 会基于统计信息自动拆分 Region。通过统计去识别出那些读流量在 10s 内持续超过阈值的 Region，并在合适的位置将这些 Region 拆分。","tags":[]},{"aliases":[],"category":"concept","filename":"MutableString","name":"MutableString","section":"what","summary":"将 []byte 低成本（不拷贝内容）地转换到 string。","tags":["TiDB","Hack"]},{"aliases":[],"category":"concept","filename":"Tombstone","name":"Tombstone","section":"what","summary":"表示该 TiKV 已处于完全下线状态，可以安全的清理该状态的 TiKV。","tags":["TiKV"]},{"aliases":[],"category":"howto","filename":"查询某张表分布在哪些 store 上","name":"查询某张表分布在哪些 Store 上","section":"how","summary":"即可。","tags":[]},{"aliases":["TiKV/TiFlash node"],"category":"concept","filename":"Store","name":"Store","section":"what","summary":"一个 tikv-server/tiflash 实例。","tags":[]},{"aliases":["Telemetry"],"category":"feature","filename":"遥测","name":"遥测","section":"what","summary":"TiDB 及相关组件会将集群信息上报给 PingCAP，用于改善产品。","tags":["TiDB","监控"]},{"aliases":["TS"],"category":"concept","filename":"TimeStamp","name":"TimeStamp","section":"what","summary":"TimeStamp 是用于 TiDB 事务系统协调的重要元素，目前设计中的 TimeStamp 分为物理和逻辑两个部分。","tags":["PD","TiDB","TiKV","txn"]},{"aliases":["CopTracker"],"category":"concept","filename":"Tracker","name":"Tracker","section":"what","summary":"TiKV 的 coprocessor 组件使用这个结构来更新性能统计数据和提供慢日志。","tags":["TiKV","coprocessor"]},{"aliases":["DT"],"category":"concept","filename":"DeltaTree","name":"DeltaTree","section":"what","summary":"TiFlash 现在使用的列式存储引擎。","tags":["TiFlash"]},{"aliases":[],"category":"where","filename":"TiDB 在 Commit 过程中拿 CommitTS","name":"TiDB 在 Commit 过程中拿 TSO","section":"where","summary":"在 这里。","tags":["txn","TiDB"]},{"aliases":[],"category":"concept","filename":"Scheduler","name":"Scheduler","section":"what","summary":"在 TiKV 的事务层中，Scheduler 负责调度 Command 的执行，当一个 Command 从被打到 TiKV 的请求中被创建之后，就会被放入这个结构中，在适当时机得到执行.并且 Scheduler 也会在 Command 的生命周期的各个阶段执行一些操作，比如记录监控数据等。","tags":["TiKV","txn"]},{"aliases":[],"category":"concept","filename":"PointGetter","name":"PointGetter","section":"what","summary":"用于点查单个 kv 对的结构体，工作于 TiKV 的 mvcc 层之上。","tags":["TiKV"]},{"aliases":[],"category":"where","filename":"TiDB 发送查其他 TiDB 内存表的请求","name":"TiDB 发送查其他 TiDB 内存表的请求","section":"where","summary":"TiDB 查其他 TiDB 内存表是通过将 TiDB 也作为一个 store 注册，查询时向其下推 cop 请求来实现的。","tags":[]},{"aliases":[],"category":"concept","filename":"CIStr","name":"CIStr","section":"what","summary":"大小写无关字符串。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"Joint Consensus","name":"Joint Consensus","section":"what","summary":"Joint Consensus 允许各个节点在不同时间在 Configuration 之间转换，而不会影响安全性。 ","tags":["raft"]},{"aliases":["cm"],"category":"concept","filename":"ConcurrencyManager","name":"ConcurrencyManager","section":"what","summary":"TiKV 中用于并发控制和内存锁管理的结构。","tags":["TiKV"]},{"aliases":[],"category":"go_down","filename":"all-pd-went-down","name":"PD节点挂掉","section":"what_if","summary":"挂掉少于一半的 PD 节点","tags":["PD"]},{"aliases":[],"category":"concept","filename":"RegionCache","name":"RegionCache","section":"what","summary":"TiDB 中用于缓存从 PD 中获取到的 Region 的地址的结构。","tags":[]},{"aliases":[],"category":"where","filename":"PD 选主","name":"PD 选主","section":"where","summary":"见代码。","tags":[]},{"aliases":[],"category":"concept","filename":"Delegate","name":"Delegate","section":"what","summary":"TiKV 上，供下游 CDC 订阅的组件，负责将 peer 上的 raft commands 转换为 CDC 事件。","tags":["TiKV","CDC"]},{"aliases":["MPP"],"category":"feature","filename":"Massive Parallel Processing","name":"Massive Parallel Processing","section":"what","summary":"通过在计算中引入跨节点的数据交换（data shuffle 过程）， TiFlash 可以支持 MPP 模式的查询，即由多个 TiFlash 节点并行处理一个查询。","tags":["TiFlash"]},{"aliases":[],"category":"concept","filename":"Retriever","name":"Retriever","section":"what","summary":"Retriever interface 是实现了 Get 和 Iter 的对象的抽象。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"LockManager","name":"LockManager","section":"what","summary":"TiKV中用于管理悲观锁的组件。","tags":["transaction","TiKV","Lock"]},{"aliases":[],"category":"concept","filename":"Resolver","name":"Resolver","section":"what","summary":"Resolver 负责计算出一个时间戳 resolved_ts，在这个时间戳之前不可能再有事务 commit。","tags":["TiKV","cdc"]},{"aliases":[],"category":"concept","filename":"KvEngine","name":"KvEngine","section":"what","summary":"TiKV 中使用的单机存储引擎的抽象。","tags":["TiKV"]},{"aliases":["cq"],"category":"concept","filename":"Completion Queue","name":"Completion Queue","section":"what","summary":"gRPC 用于缓存事件（如rpc请求）的组件，用于流控等。","tags":["grpc"]},{"aliases":[],"category":"concept","filename":"Engine","name":"Engine","section":"what","summary":"Engine 定义了存储引擎的共有行为。","tags":["TiKV"]},{"aliases":[],"category":"where","filename":"TiDB 处理SQL","name":"TiDB 开始处理一句SQL","section":"where","summary":"在 server/conn.go 中的 handleQuery 函数，TiDB 第一次意识到了自己处理的是用户传入的 SQL。","tags":["TiDB","exec","sql"]},{"aliases":["version","start_version","transaction_id","txn_id"],"category":"concept","filename":"start_ts","name":"start_ts","section":"what","summary":"事务的开始时间戳，也用于唯一标记一个事务。","tags":["TiKV","txn"]},{"aliases":["DM"],"category":"component","filename":"TiDB Data Migration","name":"TiDB Data Migration","section":"what","summary":"TiDB Data Migration (DM) 是一体化的数据迁移任务管理工具，支持从与 MySQL 协议兼容的数据库（MySQL、MariaDB、Aurora MySQL）到 TiDB 的数据迁移。","tags":["tools"]},{"aliases":[],"category":"concept","filename":"大沽路宪法","name":"大沽路宪法","section":"what","summary":"PingCAP 上海办公室的行为守则。","tags":["搞笑"]},{"aliases":["Backoff"],"category":"concept","filename":"Backoff","name":"Backoff","section":"what","summary":"指在某个操作碰到问题时等待一段时间后再重试。","tags":[]},{"aliases":[],"category":"concept","filename":"ingest sst","name":"ingest sst","section":"what","summary":"RocksDB 的导入外部 SST 文件功能，常用于备份恢复、数据迁移等。","tags":["TiKV","storage","rocksdb"]},{"aliases":[],"category":"config-item","filename":"location-labels","name":"location-labels","section":"what","summary":"表示TiKV集群拓扑结构的label。","tags":["PD"]},{"aliases":["CF"],"category":"concept","filename":"Column family","name":"Column family","section":"what","summary":"以一个 key （称为 Row key） 作为标示的一个 Column 的集合。","tags":[]},{"aliases":[],"category":"concept","filename":"Session","name":"Session","section":"what","summary":"一个 MySQL 客户端在 TiDB 侧的体现，提供了运行语句，获取 LastInsertID 等能力。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"RaftLogEngine","name":"RaftLogEngine","section":"what","summary":"一个基于 RaftEngine 实现的 RaftEngine。注意这两个 RaftEngine 的链接是不同的！","tags":["TiKV","raft"]},{"aliases":[],"category":"concept","filename":"Datum","name":"Datum","section":"what","summary":"A data box holds different kinds of data，有点像 Rust 中的 enum。常用于 TiDB 表中某个 Cell 的数据源。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"Iterator","name":"Iterator","section":"what","summary":"用于在某个 Engine 的 Snapshot 上搜索和读取 kv 对的组件。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"Protected Rollback","name":"Protected Rollback","section":"what","summary":"在引入了 Collapse Rollback 和悲观事务后，某个事务的 primary key 上的 rollback 记录可能会被 collapse 掉了，造成这个事务的 secondary keys 被意外提交。","tags":[]},{"aliases":[],"category":"concept","filename":"Commit Index","name":"Commit Index","section":"what","summary":"Commit Index 标记了目前状态机 commit 到第几个日志项了。","tags":["TiKV","Raft"]},{"aliases":[],"category":"concept","filename":"Memory Comparable Encoding","name":"Memory Comparable Encoding","section":"what","summary":"Memory Comparable Encoding 是 TiDB 中使用的一种便于在对 key 进行“修饰”（加后缀）之后仍然能保持字典顺序（上升序）的编码方式。","tags":["TiDB","TiKV"]},{"aliases":[],"category":"how","filename":"迁移组件的数据目录","name":"迁移组件的数据目录","section":"how","summary":"使用 tiup 进行如下操作：","tags":["tool"]},{"aliases":[],"category":"concept","filename":"SessionManager","name":"SessionManager","section":"what","summary":"一个表示管理 Session 情况的能力的接口。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"TxStructure","name":"TxStructure","section":"what","summary":"用于在某一个事务上进行 string，list，int64等常见结构的增删查改。","tags":["TiDB"]},{"aliases":[],"category":"feature","filename":"Follower Read","name":"Follower Read","section":"what","summary":"当客户端对一个 Follower 发起读请求的时候，这个 Follower 会请求此时 Leader 的 Commit Index，拿到 Leader 的最新的 Commit Index 后，等本地 Apply 到 Leader 最新的 Commit Index 后，然后将这条数据返回给客户端。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"外部一致性","name":"外部一致性","section":"what","summary":"指 Read 和 Write 应该遵守怎样的时间线顺序，比如 Linearizability 外部一致性级别就保证了每一个读操作都将返回“（某个标准时钟规定的）最近的写操作”。","tags":[]},{"aliases":[],"category":"concept","filename":"Scatter Range","name":"Scatter Range","section":"what","summary":"一个调度器，可以使得某个表在所有TiKV实例均匀分布。","tags":["PD","scheduling"]},{"aliases":[],"category":"handbook","filename":"AddInfoTable","name":"在 TiDB 中新建一张 infoschema 表","section":"how","summary":"在 tidb 仓库的 infoschema/tables.go，向文件一开始那个大 enum 的最后添加一条 TableXXX = \"<表名>\"","tags":["TiDB","SQL"]},{"aliases":[],"category":"concept","filename":"Short Value","name":"Short Value","section":"what","summary":"TiKV 的一个优化，如果 value 比较短，则可以直接和 write 记录一起存在 writeCF 里，而不用存在 defaultCF 里，符合这种条件的 value 就是 Short Value。","tags":[]},{"aliases":["Parallel Commits"],"category":"feature","filename":"Async commit","name":"Async commit","section":"what","summary":"对 TiKV 原有事务模型的一个优化，原本基于 Percolator 的事务模型下，从用户决定提交事务到用户感知到提交成功需要 3 次 rpc：","tags":["TiKV","txn"]},{"aliases":["endpoint"],"category":"concept","filename":"CDC Endpoint","name":"CDC Endpoint","section":"what","summary":"TiCDC 在 TiKV 中的根组件。","tags":["TiKV","CDC"]},{"aliases":["Table Partition"],"category":"concept","filename":"分区表","name":"分区表","section":"what","summary":"Table Partition 是指根据一定规则，将数据库中的一张表分解成多个更小的容易管理的部分。从逻辑上看只有一张表，但是底层却是由多个物理分区组成。","tags":[]},{"aliases":["reorg"],"category":"concept","filename":"write reorganization","name":"write reorganization","section":"what","summary":"TiDB 的异步 schema 变更过程中的一个状态，这个状态只出现在 column/index/table 创建过程中，这个状态下会给新添加的列填写数据。","tags":["TiDB","DDL","schema"]},{"aliases":[],"category":"concept","filename":"AUTO_RANDOM","name":"AUTO_RANDOM","section":"what","summary":"AUTO_RANDOM 是 TiDB 为了解决 “大批量写数据入 TiDB 时因含有整型自增主键列的表而产生的热点问题” 而引入的一个扩展特性。","tags":["TiDB","SQL"]},{"aliases":["Write Intent"],"category":"concept","filename":"Write","name":"Write","section":"what","summary":"TiKV 的事务模型中，写入到 write CF 的，保存 commit 成功的最后版本等信息的数据结构。","tags":["TiKV","txn","mvcc"]},{"aliases":[],"category":"ui","filename":"阅读 TiDB Dashboard 中的流量可视化页面","name":"阅读 TiDB Dashboard 中的流量可视化页面","section":"how","summary":"大体上我们主要关注上面的热力图：","tags":["UI","dashboard"]},{"aliases":[],"category":"feature","filename":"Super batch","name":"Super batch","section":"what","summary":"TiDB 读取 TiFlash 时的一个优化。","tags":["TiDB","TiFlash"]},{"aliases":[],"category":"component","filename":"Reparo","name":"Reparo","section":"what","summary":"Binlog 的一个配套工具，用于增量的恢复。当需要恢复增量数据时，使用 Reparo 解析文件中的 binlog，并将其应用到 TiDB／MySQL 中。","tags":["Binlog"]},{"aliases":[],"category":"concept","filename":"热点","name":"热点","section":"what","summary":"在 TiDB 系统中，可能会出现一部分业务负载不能被很好地分散，影响性能，形成单点的过高负载，这种现象称为热点现象，这里的单点就是热点。目前 TiDB 中的热点可以分为：","tags":["TiDB","TiKV"]},{"aliases":[],"category":"handbook","filename":"启用 Golang 代码中的某个 FailPoint ","name":"启用 Golang 代码中的某个 FailPoint","section":"how","summary":"使用 failpoint.Enable 使能对应的 failpoint，并传入对应 expression 控制行为即可。","tags":["Golang","FailPoint","test"]},{"aliases":[],"category":"concept","filename":"WaiterManager","name":"WaiterManager","section":"what","summary":"处理等待悲观锁的事务的等待与唤醒。","tags":["TiKV"]},{"aliases":["GA"],"category":"concept","filename":"General Availability","name":"General Availability","section":"what","summary":"我们平常说的某个 Feature GA，就是说这个 Feature 已经可以正式发布可用了。","tags":[]},{"aliases":["overlapped_rollback"],"category":"concept","filename":"Overlapping Rollback","name":"Overlapping Rollback","section":"what","summary":"在引入了 async commit 之后，由于 commit_ts 可以是算出来的，所以某一个 key 在某一个 ts 上是可能同时存在一个 rollback 记录和一个（commit_ts 是算出来的的） commit 记录的，但 TiKV 将 commit 记录和 rollback 记录存在同一个 Column Family 内，为了避免两者的冲突，我们选择在这种情况下不记 rollback 记录，而是给 commit 记录添加上 has_overlapped_rollback。（当然，不需要 protect 的 rollback 就不用管直接覆盖掉就好了）","tags":["TiKV","txn"]},{"aliases":[],"category":"feature","filename":"Amend transaction","name":"Amend transaction","section":"what","summary":"在悲观事务模式下开启该特性后，如果该事务相关的表存在并发 DDL 操作和 SCHEMA VERSION 变更，TiDB 会尝试对该事务进行 amend 操作，修正该事务的提交内容，使其和最新的有效 SCHEMA VERSION 保持一致，从而成功提交该事务而不返回 Information schema is changed 报错。","tags":["txn","TiDB"]},{"aliases":[],"category":"where","filename":"计算 SafePoint","name":"计算 GC Safe Point","section":"where","summary":"由 TiDB 在这里 计算。","tags":["TiDB"]},{"aliases":[],"category":"pattern","filename":"Testing Knob","name":"Testing Knob","section":"what","summary":"Testing Knob 是 TiDB 中一种常见的用于方便测试的 Pattern，具体指在设计 struct 时事先埋下一些供测试时调用，用于修改或者观察对象内部状态等的点，同时处理业务逻辑时也要相应地添加和这些埋的点的交互。","tags":["TiDB","testing"]},{"aliases":["amend"],"category":"concept","filename":"AmendSchema","name":"AmendSchema","section":"what","summary":"当有并发进行的DDL时，事务可以自动修改其mutation以减少 commit 失败的情况。","tags":["TiDB","txn"]},{"aliases":[],"category":"concept","filename":"configuration","name":"configuration","section":"what","summary":"指参与一致性算法决策的节点集合。","tags":["raft"]},{"aliases":[],"category":"project","filename":"kvproto","name":"kvproto","section":"what","summary":"TiKV 使用的 protobuf 文件仓库。","tags":[]},{"aliases":["One Phase Commit","1PC","one-pc","One PC"],"category":"feature","filename":"一阶段提交","name":"One Phase Commit","section":"what","summary":"如果事务只涉及一个 Region，那么在 [Async Commit](/tipedia/zh/what/Async commit.html) 的基础上，连“客户端在后台异步提交” 都不需要，Prewrite 完成后这个事务就立即成功了。这就是一阶段提交。","tags":["TiKV","txn"]},{"aliases":[],"category":"concept","filename":"Peer","name":"Peer","section":"what","summary":"同一个 Raft Group 中, replica 之间互称 peer。","tags":["TiKV","PD","scheduling"]},{"aliases":[],"category":"concept","filename":"eraftpb","name":"eraftpb","section":"what","summary":"和 Raft 中的 Entry 相关的 protobuf 定义。","tags":["protobuf"]},{"aliases":[],"category":"what_if","filename":"向刚刚成为 leader，还未完成 TSO 的同步 - 初始化的 PD 请求了 TSO","name":"向刚刚成为 leader，还未完成 TSO 的同步 & 初始化的 PD 请求了 TSO","section":"what_if","summary":"会返回错误，TiDB 侧的错误是 \"timestamp in memory isn't initialized\", \"sync hasn't completed yet, wait for a while\"。","tags":["PD","tso"]},{"aliases":[],"category":"concept","filename":"Apply","name":"Apply","section":"what","summary":"Raft 状态机实际“执行”一条 log 的过程。","tags":["TiKV","raft"]},{"aliases":[],"category":"concept","filename":"Engines","name":"Engines","section":"what","summary":"Engines = 一个 KVEngine + 一个 RaftEngine","tags":["TiKV"]},{"aliases":[],"category":"project","filename":"TiPB","name":"TiPB","section":"what","summary":"TiDB 的 protobuf 文件所在的仓库。","tags":["TiDB","protobuf","grpc"]},{"aliases":[],"category":"what_if","filename":"向非 leader 的 PD 请求了 TSO","name":"向非 leader 的 PD 请求了 TSO","section":"what_if","summary":"会返回错误，TiDB 侧的错误是 \"timestamp in memory isn't initialized\", \"not leader\"","tags":["PD","tso"]},{"aliases":["dodo"],"category":"concept","filename":"渡渡鸟","name":"渡渡鸟","section":"what","summary":"2020 年 9 月 11 日的 All Hands 上，一位 id 为渡渡鸟的同学向公司管理层提出了很多尖锐的问题。","tags":["PingCAP"]},{"aliases":[],"category":"concept","filename":"Disconnect","name":"Disconnect","section":"what","summary":"当 PD 和 TiKV 的心跳信息丢失超过 20s 后，该 TiKV 的状态会变为 Disconnect 状态，当时间超过 max-store-down-time 定义的时间后，该 TiKV 会变为 Down。","tags":["TiKV"]},{"aliases":["Consistency"],"category":"concept","filename":"内部一致性","name":"内部一致性","section":"what","summary":"内部一致性指数据库内部的数据完整性（由各类约束、触发器，再加上数据库的隔离性保证）。","tags":[]},{"aliases":[],"category":"concept","filename":"Relay Log","name":"Relay Log","section":"what","summary":"为了防止 binlog 的 drainer 异常退出造成下游集群的不一致，drainer 可以先将 binlog event 写入本地磁盘，这份 log 就是 Relay Log，再同步给下游集群，并在此过程中记录 checkpoint，开始同步时其 consistent 值为 false，结束后更新为 true。如果 drainer 启动时检测到 checkpoint 的 consistent 为 false，则会使用 Relay Log 来将下游集群同步到一致状态。","tags":["tool","binlog"]},{"aliases":[],"category":"config-item","filename":"tidb_guarantee_linearizability","name":"tidb_guarantee_linearizability","section":"what","summary":"用于控制 TiDB 的事务是否要保证 linearizability，关闭后则只保证因果一致性。","tags":["TiDB","txn"]},{"aliases":[],"category":"concept","filename":"Special Query","name":"Special Query","section":"what","summary":"Special Query 指三种执行时需要特别处理的查询：","tags":["TiDB"]},{"aliases":[],"category":"where","filename":"PD 开启 etcd","name":"PD 开启 etcd","section":"where","summary":"在 pd-server 启动之后，会立即启动一个 embedded etcd，见 代码。","tags":["PD"]},{"aliases":["TiCDC"],"category":"component","filename":"TiCDC","name":"TiCDC","section":"what","summary":"TiCDC 是一款通过拉取 TiKV 变更日志实现的 TiDB 增量数据同步工具，具有将数据还原到与上游任意 TSO 一致状态的能力，同时提供开放数据协议 (TiCDC Open Protocol)，支持其他系统订阅数据变更。","tags":[]},{"aliases":[],"category":"concept","filename":"ordinary","name":"ordinary","section":"what","summary":"在 PD 中，一般认为 TiKV 所对应的 Engine/Store 是 ordinary 的，相对的，TiFlash 对应的Engine/Store 是 special 的。","tags":["PD","scheduling"]},{"aliases":[],"category":"concept","filename":"copyset","name":"copyset","section":"what","summary":"为了降低多台服务器一起挂掉时数据因为损失了所有副本而丢失的问题，引入了 copyset 的概念。","tags":["scheduling"]},{"aliases":[],"category":"paper","filename":"Percolator","name":"Percolator","section":"what","summary":"Google 的分布式事务解决方案，TiKV 的 分布式事务模型最初是基于 Percolator 构建。","tags":[]},{"aliases":[],"category":"feature","filename":"Follower forward request","name":"Follower forward request","section":"what","summary":"若某组件与上游组件的 leader 网络隔离，但与上游组件的 follower 间网络正常、上游组件的follower 和 leader 间网络正常，则对上游组件的请求会转发给 follower，再由 follower 转给 leader。","tags":["PD","TiDB","TiKV"]},{"aliases":[],"category":"config-item","filename":"tidb_executor_concurrency","name":"词条名","section":"what","summary":"用于控制各个 SQL 算子的并发度，包括：","tags":["TiDB","executor"]},{"aliases":[],"category":"concept","filename":"Snapshot","name":"Snapshot","section":"what","summary":"某个时间点下某个 Engine 的视图。","tags":["TiKV"]},{"aliases":[],"category":"component","filename":"autoID","name":"autoID","section":"what","summary":"TiDB 中负责分配和操作（主要是 rebase 操作，即修改已经分配过的最大值来操纵后面的值如何分配）各种 ID （包括Table ID，自增列的值等）的组件。","tags":["TiDB"]},{"aliases":["Tablet (Spanner，YugabyteDB)","Range (CRDB)","Raft group"],"category":"concept","filename":"Region","name":"Region","section":"what","summary":"保存的所有数据中的一部分，这一部分数据作为一个raft group储存在一起。","tags":["TiKV","PD","scheduling"]},{"aliases":[],"category":"how","filename":"根据 Table ID 查询表名","name":"根据 Table ID 查询表名","section":"what","summary":"当然也可以查到一些别的元信息，比如所在数据库、元信息等。","tags":["TiDB","SQL"]},{"aliases":[],"category":"concept","filename":"Storage","name":"Storage","section":"what","summary":"Storage 在一个给定 Engine 上实现了 transactional KV API 和 raw KV API。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"Write Stall","name":"Write Stall","section":"what","summary":"当上层写入 RocksDB 速度过快，RocksDB 就会对写入进行降速（stall）处理。主要有以下几个 stall 的点：","tags":["Rocksdb"]},{"aliases":[],"category":"config-item","filename":"nortcheck","name":"nortcheck","section":"what","summary":"在 TiKV 编译时可以通过开启这个 feature 来跳过在 rust-rocksdb 中的 Iterator 合法性检查，同样的检查在 rocksdb 本身中也会进行，但一旦 rocksdb 的检查失败就会使得整个进程被 kill 掉，这对测试十分不利。故引入这个 feature。","tags":["TiKV","rocksdb","rust-rocksdb"]},{"aliases":[],"category":"how","filename":"创建一张分布在多个 TiKV","name":"创建一张分布在多个 TiKV 上的表","section":"how","summary":"注意：首先请确保你真的使用了有多个（三个以上） TiKV 节点的集群。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"Command","name":"Command","section":"what","summary":"在 TiKV 的事务层中，每一个要执行某种动作的请求都被抽象为一个command。现有的 command 有：","tags":["TiKV","txn"]},{"aliases":[],"category":"concept","filename":"ReadPool","name":"ReadPool","section":"what","summary":"一个 TiKV 会在其中执行大部分读取请求的线程池。","tags":["TiKV"]},{"aliases":[],"category":"how","filename":"TiDB是如何将表中的行、列数据映射到KV的","name":"TiDB 是如何将表中的行、列数据映射到KV的","section":"how","summary":"每行数据按照如下规则进行编码成 Key-Value pair：","tags":["TiDB","TiKV","codec"]},{"aliases":["Service Level Objective","SLO"],"category":"concept","filename":"服务级别目标","name":"服务级别目标","section":"what","summary":"服务级别目标（Service-level objective，SLO）是指服务提供者向客户作出的服务保证的量化指标。","tags":["DBaaS"]},{"aliases":[],"category":"concept","filename":"MemoryStatsAccessor","name":"MemoryStatsAccessor","section":"what","summary":"TiKV 中用来统计线程内存使用状况的结构体。","tags":["TiKV","alloc"]},{"aliases":[],"category":"concept","filename":"Titan","name":"Titan","section":"what","summary":"RocksDB 的一个插件，支持将比较大的 value 从 LSM-tree 中分离出来单独存储，以降低写放大。","tags":["RocksDB","TiKV"]},{"aliases":[],"category":"concept","filename":"min_commit_ts","name":"min_commit_ts","section":"what","summary":"min_commit_ts 指事务预期最早被提交的时间戳，在两个场合被使用：","tags":["TiKV","txn","largeTxn","asyncCommit"]},{"aliases":[],"category":"concept","filename":"Down","name":"Down","section":"what","summary":"表示该 TiKV 与集群失去链接的时间已经超过了 max-store-down-time 定义的时间，默认 30 分钟，超过该时间后，相应的 TiKV 会变为 Down，并且开始在存活的 TiKV 上补足各个 Region 的副本。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"Detector","name":"Detector","section":"what","summary":"死锁检测器，是 LockManager 的一部分。","tags":["TiKV","txn"]},{"aliases":[],"category":"concept","filename":"Commit","name":"Commit","section":"what","summary":"在 raft 状态机中如果 leader 觉得一条 log 可以被接受了，则认为这条 log commit 成功了。","tags":["raft"]},{"aliases":[],"category":"feature","filename":"动态裁剪模式","name":"动态裁剪模式","section":"what","summary":"原本 TiDB  在涉及分区表的多个分区上的查询时，算子单独访问每个分区，然后通过 Union 将结果合并起来。","tags":["TiDB","分区表"]},{"aliases":[],"category":"concept","filename":"chunk-ListInDisk 文件","name":"chunk.ListInDisk 文件","section":"what","summary":"join/sort/agg 计算落盘时产生的临时数据文件，SQL 执行完后应该被立即删除。","tags":["TiDB"]},{"aliases":[],"category":"where","filename":"Hash Join 时遇到内存不足时将数据 spill 到磁盘","name":"Hash Join 时遇到内存不足时将数据 spill 到磁盘","section":"where","summary":"如果用户在配置文件中设置了 OOMUseTmpStorage，在内存不足时 TiDB 会将内存中放不下的数据 spill 到磁盘，这一行为在 executor/join.go 中注册到 memory.Tracker。在 Consume 内存时，如果发现了OOM，就会调用这里设置的 action。","tags":["TiDB","excutor"]},{"aliases":[],"category":"where","filename":"TiDB 建表","name":"TiDB 建表","section":"where","summary":"在将建表的语句编译到 Executor 的对应变种 DDLExec 之后，由其上的 executeCreateTable 调用 ddl.CreateTableWithInfo 将建表工作化为 Job，放入 DDL 执行队列异步执行。在 worker.runDDLJob 函数中，Job 被从队列中取出，并根据任务的具体类型，被分配到使用 onCreateTable 执行，然后调用 createTableOrViewWithCheck，用 Meta.CreateTableOrView 最终将表的元信息编码为 KV 对，并通过 HSet 写入到事务中，并最终提交到 TiKV。","tags":["TiDB","DDL"]},{"aliases":[],"category":"concept","filename":"gc_fence","name":"gc_fence","section":"what","summary":"为了防止后写入的，和前面某个 commit overlap 的 rollback 动作把某个已经 GC 掉的 Commit Record “写回来”，造成读到理应已经 GC 掉的数据，我们会在 Write 的 gc_fence 字段记录：","tags":["tikv","txn","gc"]},{"aliases":[],"category":"concept","filename":"TxnScope","name":"TxnScope","section":"what","summary":"TiDB 5.0 版本中，为加强 TiDB 的跨中心部署能力，将事务分成了 Local （只访问本地数据中心）和 Global （可访问所有数据中心） 两类，在 TiDB 中使用 TxnScope 标明每个事务的作用域。","tags":["TiDB","txn"]},{"aliases":[],"category":"concept","filename":"Transport","name":"Transport","section":"what","summary":"用于表示派发 RaftMessage 能力的 trait。","tags":["TiKV","raft"]},{"aliases":[],"category":"concept","filename":"Context","name":"Context","section":"what","summary":"TiKV 请求上附加的一些不属于请求本身的必要信息，包括 region 信息，隔离级别等。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"Compation","name":"compation","section":"what","summary":"将LSM Tree中的小SST文件合并成一个大的SST文件。","tags":["TiKV","storage"]},{"aliases":[],"category":"concept","filename":"Index Nested Loop Merge Join","name":"Index Nested Loop Merge Join","section":"what","summary":"即可以内部走index的，外表经过 WHERE 条件过滤后结果集较小（小于 1 万行），join keys 中的内表列集合是内表使用的 index 的前缀，或内表使用的 index 是 join keys 中的内表列集合的前缀的场景下，该算法相比于 index loop join 会更节省内存。","tags":["TiDB","optimizer"]},{"aliases":[],"category":"concept","filename":"Modify","name":"Modify","section":"what","summary":"在 TiKV 的某个 [Column Family](/tipedia/zh/what/Column family.html) 上进行某种修改的请求。","tags":["TiKV","txn","mvcc"]},{"aliases":[],"category":"concept","filename":"Offline","name":"Offline","section":"what","summary":"当对某个 TiKV 缩容后，该 TiKV 会变为 Offline 状态，该状态只是 TiKV 下线的中间状态，处于该状态的 TiKV 会进行 leader 的 transfter 和 region balance ，当 leader_count/region_count (pd-ctl 获取) 均显示 transfter 或 balance 完毕后，该 TiKV 会由 Offline -> Tombstone。在 Offline 状态时，禁止关闭该 TiKV 服务以及其所在的物理服务器。","tags":["TiKV"]},{"aliases":[],"category":"design-idea","filename":"pd-on-etcd","name":"PD 依赖 etcd","section":"why","summary":"原因主要有：","tags":["PD","etcd"]},{"aliases":["Cluster Index"],"category":"feature","filename":"聚簇索引","name":"聚簇索引","section":"what","summary":"即数据行和索引存储在一起，在实现这个 feature 之前，TiDB 只能在单列 INTEGER/BIGINT 主键上启用聚簇索引。","tags":["TiDB"]},{"aliases":[],"category":"how","filename":"运行TiDBPD中的单个test","name":"运行 TiDB/PD 中的单个 test","section":"how","summary":"在 TiDB 和 PD 我们使用一个魔改过的 gocheck 作为测试框架。","tags":["TiDB","PD","Golang"]},{"aliases":["RegionEpoch"],"category":"concept","filename":"Region Epoch","name":"Region Epoch","section":"what","summary":"可以简单地理解为 region 的版本号，具体结构如下：","tags":["PD"]},{"aliases":[],"category":"concept","filename":"Cursor","name":"Cursor","section":"what","summary":"用于在某个 [Column Family](/tipedia/zh/what/Column family.html) 中搜索和读取 kv 对的组件。","tags":["TiKV"]},{"aliases":[],"category":"concept","filename":"Cascades Planner","name":"Cascades Planner","section":"what","summary":"TiDB 的下一代 Planner 架构。","tags":["TiDB","planner"]},{"aliases":[],"category":"feature","filename":"Placement Rule","name":"Placement Rule","section":"what","summary":"Placement Rules 是 PD 在 4.0 版本引入的试验特性，它是一套副本规则系统，用于指导 PD 针对不同类型的数据生成对应的调度。通过组合不同的调度规则，用户可以精细地控制任何一段连续数据的副本数量、存放位置、主机类型、是否参与 Raft 投票、是否可以担任 Raft leader 等属性。","tags":["PD"]},{"aliases":[],"category":"optimize","filename":"Collapse Rollback","name":"Collapse Rollback","section":"what","summary":"如果一个 key 被连续多次 rollback，我们可以将这些 rollback 合并，只保留最后一个 rollback。以免 write column family 的大量数据拖慢读取。","tags":["TiKV","txn"]},{"aliases":[],"category":"why","filename":"TiKV 需要 Rollback 类型的 Write","name":"TiKV 需要 Rollback 类型的 Write","section":"why","summary":"一个事务回滚之后，由于网络延迟、用户操作等原因 TiKV 仍然有可能收到同一个事务的 prewrite 请求，为了防止该 key 被上锁，在其 TTL 过期之前阻塞其它对该 key 的读写。通过写入 rollback 记录，如果在 rollback 之后收到同一个事务的 prewrite，会返回 WriteConflict。","tags":["TiKV","txn"]},{"aliases":[],"category":"concept","filename":"算子","name":"算子","section":"what","summary":"TiDB 的执行计划是一个树形结构，树中每个节点即是算子。","tags":["TiDB","optimizer"]},{"aliases":[],"category":"concept","filename":"Mutator","name":"Mutator","section":"what","summary":"Mutator interface 是实现了 Get 和 Iter 的对象的抽象。","tags":["TiDB"]},{"aliases":[],"category":"concept","filename":"Down Peer","name":"Down Peer","section":"what","summary":"有副本状态为 Down 的 Region。","tags":[]},{"aliases":[],"category":"concept","filename":"Scanner","name":"Scanner","section":"what","summary":"TiKV 中用于进行 mvcc 扫描读取的组件","tags":["TiKV","txn"]},{"aliases":[],"category":"concept","filename":"MvccChecker","name":"MvccChecker","section":"what","summary":"用来修复 mvcc 数据不一致的结构。","tags":["failover","TiKV"]}];
        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document);
    </script>
</head>

<body>
    <div id="root">
        <div class="jss1">
            <header
                class="MuiPaper-root MuiAppBar-root MuiAppBar-positionAbsolute MuiAppBar-colorPrimary jss13 header-bar MuiPaper-elevation4">
                <div class="MuiToolbar-root MuiToolbar-regular jss11 MuiToolbar-gutters">
                    <button
                        class="MuiButtonBase-root MuiIconButton-root jss15 jss16 MuiIconButton-colorInherit MuiIconButton-edgeStart"
                        tabindex="0" type="button" aria-label="open drawer"><span class="MuiIconButton-label"><svg
                                class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
                            </svg></span><span class="MuiTouchRipple-root"></span></button>
                    <h1
                        class="MuiTypography-root jss12 MuiTypography-h6 MuiTypography-colorInherit MuiTypography-noWrap">
                        Tipedia
                    </h1>
                    <button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-colorInherit" tabindex="0"
                        type="button" aria-controls="language-menu" id="language-menu-button" aria-haspopup="true">
                        <span class="MuiButton-label">
                            <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z">
                                </path>
                            </svg>
                            <span class="jss21">中文</span>
                            <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path>
                            </svg>
                        </span>
                        <span class="MuiTouchRipple-root"></span>
                    </button>
                    <div class="jss17">
                        <div class="jss18">
                            <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z">
                                </path>
                            </svg>
                        </div>
                        <div class="MuiInputBase-root jss19"><input placeholder="Search…" type="text"
                                aria-label="search" class="MuiInputBase-input search-input" value=""></div>
                    </div>
                    <a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit" tabindex="0"
                        aria-disabled="false" href="https://github.com/longfangsong/tipedia"><span
                            class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false"
                                viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3">
                                </path>
                            </svg></span><span class="MuiTouchRipple-root"></span></a>
                </div>
            </header>
            <div class="MuiDrawer-root MuiDrawer-docked" data-nosnippet>
                <div
                    class="MuiPaper-root MuiDrawer-paper side-bar MuiDrawer-paperAnchorLeft MuiDrawer-paperAnchorDockedLeft MuiPaper-elevation0">
                    <div class="jss2">
                        <button class="MuiButtonBase-root MuiIconButton-root" tabindex="0" type="button"
                            id="expand-button"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root"
                                    focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                                </svg></span><span class="MuiTouchRipple-root"></span></button>
                    </div>
                    <hr class="MuiDivider-root">
                    <div class="MuiList-root MuiList-padding">
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/index.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root">
                                <span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">首页</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" aria-disabled="false" id="random-page">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7.5 18c-.83 0-1.5-.67-1.5-1.5S6.67 15 7.5 15s1.5.67 1.5 1.5S8.33 18 7.5 18zm0-9C6.67 9 6 8.33 6 7.5S6.67 6 7.5 6 9 6.67 9 7.5 8.33 9 7.5 9zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm0-9c-.83 0-1.5-.67-1.5-1.5S15.67 6 16.5 6s1.5.67 1.5 1.5S17.33 9 16.5 9z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">随机页面</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <hr class="MuiDivider-root">
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/how/index.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">如何 ...</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/why/index.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">为何 ...</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/where/index.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">... 在哪里</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/what_if/index.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">如果 ... 会怎样</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/compatibility.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">兼容性</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                        <hr class="MuiDivider-root">
                        <a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button"
                            tabindex="0" href="https://longfangsong.github.io/tipedia/zh/about.html"
                            aria-disabled="false">
                            <div class="MuiListItemIcon-root">
                                <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z">
                                    </path>
                                </svg>
                            </div>
                            <div class="MuiListItemText-root"><span
                                    class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">关于此网站</span>
                            </div>
                            <span class="MuiTouchRipple-root"></span>
                        </a>
                    </div>
                </div>
            </div>
            <main class="jss6">
                <div class="MuiBackdrop-root search-container" aria-hidden="true"
                    style="opacity: 0; visibility: hidden;">
                    <ul class="MuiList-root table-itemname MuiList-padding" id="search-result">
                    </ul>
                </div>
                <div class="jss5"></div>
                <div class="MuiContainer-root jss7 MuiContainer-maxWidthLg">
                    
<div class="page">
    
<h1>Offline</h1>
<span class="last-edited">Last edited by longfangsong at 2021-03-30</span>
<div class="tags">
    
    <span class="tag TiKV">TiKV</span>
    
</div>

<p>当对某个 TiKV 缩容后，该 TiKV 会变为 Offline 状态，该状态只是 TiKV 下线的中间状态，处于该状态的 TiKV 会进行 leader 的 transfter 和 region balance ，当 leader_count/region_count (pd-ctl 获取) 均显示 transfter 或 balance 完毕后，该 TiKV 会由 Offline -&gt; Tombstone。在 Offline 状态时，禁止关闭该 TiKV 服务以及其所在的物理服务器。</p>
<h2>Links</h2>
<ul>
<li><a href="https://asktug.com/t/topic/37551">AskTUG 上的文章</a></li>
</ul>


</div>

                </div>
            </main>
        </div>
    </div>
    <div role="presentation" class="MuiPopover-root hidden" id="language-menu" aria-hidden="true"
        style="position: fixed; z-index: 1300; inset: 0;" data-nosnippet>
        <div tabindex="0" data-test="sentinelStart"></div>
        <div class="MuiPaper-root MuiMenu-paper MuiPopover-paper MuiPaper-elevation8 MuiPaper-rounded" tabindex="-1"
            style="">
            <ul class="MuiList-root MuiMenu-list MuiList-padding" role="menu" tabindex="-1">
                <li class="MuiButtonBase-root MuiListItem-root MuiMenuItem-root MuiMenuItem-gutters MuiListItem-gutters MuiListItem-button"
                    tabindex="0" role="menuitem" aria-disabled="false">
                    <a href="https://longfangsong.github.io/tipedia/zh/index.html">中文</a>
                    <span class="MuiTouchRipple-root"></span>
                </li>
                <li class="MuiButtonBase-root MuiListItem-root MuiMenuItem-root MuiMenuItem-gutters MuiListItem-gutters MuiListItem-button"
                    tabindex="-1" role="menuitem" aria-disabled="false">
                    <a href="https://longfangsong.github.io/tipedia/en/index.html">English</a>
                    <span class="MuiTouchRipple-root"></span>
                </li>
            </ul>
        </div>
        <div tabindex="0" data-test="sentinelEnd"></div>
        <script src="https://longfangsong.github.io/tipedia/static/shared.js"></script>
        <script src="https://longfangsong.github.io/tipedia/static/random_page.js"></script>
        <script src="https://longfangsong.github.io/tipedia/static/fuse.js"></script>
        <script src="https://longfangsong.github.io/tipedia/static/search.js"></script>
    </div>
</body>

</html>